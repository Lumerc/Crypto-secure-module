# Crypto Balance Module

–ú–æ–¥—É–ª—å –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É—á–µ—Ç–∞ –∫—Ä–∏–ø—Ç–æ-–±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Laravel —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∑–∞—á–∏—Å–ª–µ–Ω–∏—è –∏ —Å–ø–∏—Å–∞–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤, —É—á–µ—Ç–æ–º –±–ª–æ–∫—á–µ–π–Ω-–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –∏ –∑–∞—â–∏—Ç–æ–π –æ—Ç race conditions.

## üéØ –°—É—Ç—å –ø—Ä–æ–µ–∫—Ç–∞

–ú–æ–¥—É–ª—å —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á—É –Ω–∞–¥–µ–∂–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã–º–∏ –±–∞–ª–∞–Ω—Å–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∏—Å–ø–æ–ª—å–∑—É—è **—Å–∞—Ç–æ—à–∏ (—Ü–µ–ª—ã–µ —á–∏—Å–ª–∞)** –¥–ª—è –∞–±—Å–æ–ª—é—Ç–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è float.

## üì¶ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ó–∞—á–∏—Å–ª–µ–Ω–∏–µ –∏ —Å–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ (–≤—ã–≤–æ–¥—ã, –ø–ª–∞—Ç–µ–∂–∏, –∫–æ–º–∏—Å—Å–∏–∏)
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥–∏ (Redis)
- –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## üèó –°—Ç—Ä—É–∫—Ç—É—Ä–∞

### –ú–æ–¥–µ–ª–∏
- **CryptoBalance** ‚Äî –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ–ª—è: `user_id`, `currency`, `balance_satoshi`, `locked_satoshi`)
- **CryptoTransaction** ‚Äî –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (—Ç–∏–ø—ã: credit/debit/withdrawal/payment/fee, —Å—Ç–∞—Ç—É—Å—ã: pending/completed/failed)

### –°–µ—Ä–≤–∏—Å—ã
- **CryptoBalanceService** ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (credit, debit, confirm, cancel)
- **BlockchainService** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –±–ª–æ–∫—á–µ–π–Ω–µ

### Jobs
- **ProcessWithdrawal** ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤—ã–≤–æ–¥–∞ –≤ –±–ª–æ–∫—á–µ–π–Ω
- **CheckTransactionConfirmations** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π

## üì° API

- `GET /api/balances` ‚Äî –≤—Å–µ –±–∞–ª–∞–Ω—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /api/balances/{currency}` ‚Äî –±–∞–ª–∞–Ω—Å –ø–æ –≤–∞–ª—é—Ç–µ
- `POST /api/balances/credit` ‚Äî –∑–∞—á–∏—Å–ª–µ–Ω–∏–µ
- `POST /api/balances/debit` ‚Äî —Å–ø–∏—Å–∞–Ω–∏–µ
- `GET /api/transactions` ‚Äî –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

## üõ† –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- PHP 8.4+, Laravel 11+
- MySQL/PostgreSQL
- Redis

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
composer install
php artisan migrate
php artisan queue:work
```

üîí –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
–í—Å–µ —Å—É–º–º—ã –≤ —Å–∞—Ç–æ—à–∏ ‚Äî –Ω–∏–∫–∞–∫–∏—Ö float
–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç race conditions
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å ‚Äî –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è ‚Äî –∂–¥–µ–º N –±–ª–æ–∫–æ–≤ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
