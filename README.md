# Crypto Balance Module

–ú–æ–¥—É–ª—å –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É—á–µ—Ç–∞ –∫—Ä–∏–ø—Ç–æ-–±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Laravel —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∑–∞—á–∏—Å–ª–µ–Ω–∏—è –∏ —Å–ø–∏—Å–∞–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤, —É—á–µ—Ç–æ–º –±–ª–æ–∫—á–µ–π–Ω-–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –∏ –∑–∞—â–∏—Ç–æ–π –æ—Ç race conditions.

## üéØ –°—É—Ç—å –ø—Ä–æ–µ–∫—Ç–∞

–ú–æ–¥—É–ª—å —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á—É –Ω–∞–¥–µ–∂–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã–º–∏ –±–∞–ª–∞–Ω—Å–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∏—Å–ø–æ–ª—å–∑—É—è **—Å–∞—Ç–æ—à–∏ (—Ü–µ–ª—ã–µ —á–∏—Å–ª–∞)** –¥–ª—è –∞–±—Å–æ–ª—é—Ç–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è float.

## üì¶ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ó–∞—á–∏—Å–ª–µ–Ω–∏–µ –∏ —Å–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ (–≤—ã–≤–æ–¥—ã, –ø–ª–∞—Ç–µ–∂–∏, –∫–æ–º–∏—Å—Å–∏–∏)
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥–∏ (Redis)
- –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## üèó –°—Ç—Ä—É–∫—Ç—É—Ä–∞

### –ú–æ–¥–µ–ª–∏
- **CryptoBalance** ‚Äî –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ–ª—è: `user_id`, `currency`, `balance_satoshi`, `locked_satoshi`)
- **CryptoTransaction** ‚Äî –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (—Ç–∏–ø—ã: credit/debit/withdrawal/payment/fee, —Å—Ç–∞—Ç—É—Å—ã: pending/completed/failed)

### –°–µ—Ä–≤–∏—Å—ã
- **CryptoBalanceService** ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (credit, debit, confirm, cancel)
- **BlockchainService** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –±–ª–æ–∫—á–µ–π–Ω–µ

### Jobs
- **ProcessWithdrawal** ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤—ã–≤–æ–¥–∞ –≤ –±–ª–æ–∫—á–µ–π–Ω
- **CheckTransactionConfirmations** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π

# Crypto Balance Module

–ú–æ–¥—É–ª—å –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É—á–µ—Ç–∞ –∫—Ä–∏–ø—Ç–æ-–±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Laravel —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∑–∞—á–∏—Å–ª–µ–Ω–∏—è –∏ —Å–ø–∏—Å–∞–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤, —É—á–µ—Ç–æ–º –±–ª–æ–∫—á–µ–π–Ω-–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –∏ –∑–∞—â–∏—Ç–æ–π –æ—Ç race conditions.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* –ó–∞—á–∏—Å–ª–µ–Ω–∏–µ –∏ —Å–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ (–≤—ã–≤–æ–¥—ã, –ø–ª–∞—Ç–µ–∂–∏, –∫–æ–º–∏—Å—Å–∏–∏)
* –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
* –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥–∏ (Redis)
* –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
* REST API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

* Docker 20.10+
* Docker Compose 2.0+
* Git

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone https://github.com/Lumerc/Crypto-secure-module/

cd crypto-secure-module

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose up -d --build

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
docker-compose exec app composer install

docker-compose exec app cp .env.example .env

docker-compose exec app php artisan key:generate


### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
–í —Ñ–∞–π–ª–µ .env –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —É–∂–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

DB_CONNECTION=mysql

DB_HOST=db

DB_PORT=3306

DB_DATABASE=laravel

DB_USERNAME=root

DB_PASSWORD=root


QUEUE_CONNECTION=redis

REDIS_HOST=redis

REDIS_PASSWORD=null

REDIS_PORT=6379

### –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π
docker-compose exec app php artisan migrate

### –ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–∞ –æ—á–µ—Ä–µ–¥–µ–π
–í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

docker-compose exec app php artisan queue:work

üì° API Endpoints

–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –∞–¥—Ä–µ—Å—É http://localhost:8083/api/

–ú–µ—Ç–æ–¥	Endpoint	–û–ø–∏—Å–∞–Ω–∏–µ
GET	/balances	–í—Å–µ –±–∞–ª–∞–Ω—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET	/balances/{currency}	–ë–∞–ª–∞–Ω—Å –ø–æ –≤–∞–ª—é—Ç–µ (BTC, ETH, USDT)
POST	/balances/credit	–ó–∞—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
POST	/balances/debit	–°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
GET	/transactions	–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
GET	/transactions/{uuid}	–î–µ—Ç–∞–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

üîí –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
–í—Å–µ —Å—É–º–º—ã –≤ —Å–∞—Ç–æ—à–∏ ‚Äî –Ω–∏–∫–∞–∫–∏—Ö float
–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç race conditions
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å ‚Äî –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è ‚Äî –∂–¥–µ–º N –±–ª–æ–∫–æ–≤ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
